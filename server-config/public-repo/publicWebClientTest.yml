# something breaks here when trying to install the web apps
# ModuleNotFoundError: No module named 'django.core.urlresolvers'
- hosts: national_omero_repo
  roles:
    - role: ome.basedeps
    - role: ome.omero_web
      omero_web_config_set:
        omero.web.public.enabled: true
        omero.web.public.server_id: 1
        omero.web.public.user: public
        omero.web.public.password: "{{ omero_web_public_password }}"
        omero.web.public.url_filter: "^/(webadmin/myphoto/|webclient/\
          (?!(action|logout|annotate_(file|tags|comment|rating|map)|\
          script_ui|ome_tiff|figure_script))|\
          webgateway/(?!(archived_files|download_as))\
          |iviewer/|mapr/|figure/)"
        omero.web.server_list:
          - ['206.12.94.73', 4064, omero]
      omero_web_apps_packages:
        - omero-figure
        - omero-iviewer
        - omero-mapr
        - omero-parade
      omero_web_apps_names:
        - omero_figure
        - omero_iviewer
        - omero_mapr
        - omero_parade
      omero_web_apps_config_set:
        omero.web.viewer.view: omero_iviewer.views.index
        omero.web.mapr.config:
          - menu: anyvalue
            config:
              default:
                - Any Value
              all: []
              ns:
                - openmicroscopy.org/omero/client/mapAnnotation
              label: Any
      omero_web_apps_config_append:
        omero.web.open_with:
          - - omero_iviewer
            - omero_iviewer_index
            - supported_objects:
                - images
                - dataset
                - well
              script_url: omero_iviewer/openwith.js
              label: OMERO.iviewer
          - - omero_figure
            - new_figure
            - supported_objects:
                - images
              target: _blank
              label: OMERO.figure
        omero.web.ui.center_plugins:
          - - Parade
            - omero_parade/init.js.html
            - omero_parade
      omero_web_apps_top_links:
        - label: Figure
          link: figure_index
          attrs:
            title: Open Figure in new tab
            target: _blank
        - label: Any Value
          link:
            viewname: maprindex_anyvalue
          attrs:
            title: Find Any Value

  # tasks:

  #   - name: Download the Figure_To_Pdf.py script
  #     become: true
  #     become_user: omero-server
  #     get_url:
  #       dest:
  #         /opt/omero/server/OMERO.server/lib/scripts/omero/figure_scripts/Figure_To_Pdf.py
  #       mode: 0644
  #       url:
  #         https://raw.githubusercontent.com/ome/omero-figure/HEAD/omero_figure/scripts/omero/figure_scripts/Figure_To_Pdf.py


  vars:
    omero_web_public_password: public